{% extends "base.html" %}

{% block title %}Send Message - Admin Dashboard{% endblock %}

{% block content %}
<div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 sm:mb-8 space-y-2 sm:space-y-0">
    <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 flex items-center">
        <i class="fas fa-envelope mr-2 sm:mr-3"></i>Send Message
    </h1>
    <a href="{{ url_for('admin_homework_records') }}" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition duration-200 text-sm">
        <i class="fas fa-arrow-left mr-1"></i>Back to Records
    </a>
</div>

<!-- Send Message Form -->
<div class="bg-white rounded-xl shadow-lg p-6">
    <form method="POST" class="space-y-6">
        <!-- Recipient Type -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-users mr-1"></i>Recipient Type
            </label>
            <div class="space-y-2">
                <label class="flex items-center">
                    <input type="radio" name="recipient_type" value="all" class="mr-2" 
                           {% if not request.args.get('teacher_id') %}checked{% endif %}
                           onchange="toggleTeacherSelection(false)">
                    <span class="text-sm text-gray-700">Send to All Teachers</span>
                </label>
                <label class="flex items-center">
                    <input type="radio" name="recipient_type" value="specific" class="mr-2"
                           {% if request.args.get('teacher_id') %}checked{% endif %}
                           onchange="toggleTeacherSelection(true)">
                    <span class="text-sm text-gray-700">Send to Specific Teacher</span>
                </label>
            </div>
        </div>

        <!-- Teacher Selection (Hidden by default) -->
        <div id="teacherSelection" style="display: {% if request.args.get('teacher_id') %}block{% else %}none{% endif %};">
            <label for="teacher_id" class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-user mr-1"></i>Select Teacher
            </label>
            <select id="teacher_id" name="teacher_id" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                <option value="">Choose a teacher...</option>
                {% for teacher in teachers %}
                <option value="{{ teacher.id }}" 
                        {% if request.args.get('teacher_id') == teacher.id|string %}selected{% endif %}>
                    {{ teacher.first_name }} {{ teacher.last_name }} ({{ teacher.email }})
                </option>
                {% endfor %}
            </select>
        </div>

        <!-- Subject -->
        <div>
            <label for="subject" class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-tag mr-1"></i>Subject
            </label>
            <input type="text" id="subject" name="subject" required
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"
                placeholder="Enter message subject...">
        </div>

        <!-- Content -->
        <div>
            <label for="content" class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-file-text mr-1"></i>Message Content
            </label>
            <textarea id="content" name="content" rows="8" required
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"
                placeholder="Enter your message content..."></textarea>
        </div>

        <!-- Submit Buttons -->
        <div class="flex justify-end space-x-3 pt-6 border-t border-gray-200">
            <a href="{{ url_for('admin_homework_records') }}" class="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400 transition duration-200">
                Cancel
            </a>
            <button type="submit" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition duration-200">
                <i class="fas fa-paper-plane mr-1"></i>Send Message
            </button>
        </div>
    </form>
</div>

<!-- Instructions -->
<div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
    <div class="flex">
        <div class="flex-shrink-0">
            <i class="fas fa-info-circle text-blue-400"></i>
        </div>
        <div class="ml-3">
            <h3 class="text-sm font-medium text-blue-800">Instructions</h3>
            <div class="mt-2 text-sm text-blue-700">
                <ul class="list-disc list-inside space-y-1">
                    <li>Choose to send a message to all teachers or a specific teacher</li>
                    <li>Provide a clear subject line for the message</li>
                    <li>Write your message content in the text area</li>
                    <li>Teachers will receive notifications when they have new messages</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
function toggleTeacherSelection(show) {
    const teacherSelection = document.getElementById('teacherSelection');
    const teacherSelect = document.getElementById('teacher_id');
    
    if (show) {
        teacherSelection.style.display = 'block';
        teacherSelect.required = true;
    } else {
        teacherSelection.style.display = 'none';
        teacherSelect.required = false;
        teacherSelect.value = '';
    }
}

// Auto-fill subject if coming from homework record
document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const teacherName = urlParams.get('teacher_name');
    const subjectField = document.getElementById('subject');
    
    if (teacherName && !subjectField.value) {
        subjectField.value = `Message regarding homework record - ${teacherName}`;
    }
});
</script>
{% endblock %}
